<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NBA Injuries (By Team)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body { margin: 0; background: #0b0f19; color: #e8eefc; }
    header { padding: 20px 16px; border-bottom: 1px solid rgba(255,255,255,.08); position: sticky; top: 0; background: rgba(11,15,25,.92); backdrop-filter: blur(8px); }
    h1 { margin: 0 0 8px; font-size: 18px; font-weight: 700; }
    .meta { font-size: 12px; opacity: .8; display:flex; gap:12px; flex-wrap: wrap; }
    .row { display:flex; gap:10px; margin-top: 12px; flex-wrap: wrap; }
    input { flex: 1; min-width: 220px; padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.06); color: #e8eefc; outline: none; }
    button { padding: 10px 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.08); color:#e8eefc; cursor:pointer; }
    main { padding: 16px; max-width: 980px; margin: 0 auto; }
    .team { border: 1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.04); border-radius: 14px; margin-bottom: 12px; overflow: hidden; }
    .team summary { list-style:none; cursor:pointer; padding: 14px 14px; display:flex; align-items:center; justify-content: space-between; gap: 10px; }
    .team summary::-webkit-details-marker { display:none; }
    .teamName { font-weight: 800; }
    .badge { font-size: 12px; padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,.14); opacity: .9; }
    .list { padding: 0 14px 14px; display:grid; gap: 10px; }
    .card { border: 1px solid rgba(255,255,255,.10); background: rgba(0,0,0,.18); border-radius: 12px; padding: 12px; }
    .topline { display:flex; justify-content: space-between; gap: 10px; align-items: baseline; flex-wrap: wrap; }
    .player { font-weight: 800; }
    .status { font-weight: 800; font-size: 12px; padding: 3px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,.14); }
    .sub { margin-top: 6px; font-size: 13px; opacity:.9; }
    .tiny { margin-top: 6px; font-size: 12px; opacity:.7; }
    .error { padding: 12px; border-radius: 12px; border: 1px solid rgba(255,80,80,.35); background: rgba(255,80,80,.10); }
  </style>
</head>
<body>
  <header>
    <h1>NBA Injuries — Grouped by Team</h1>
    <div class="meta">
      <div id="source"></div>
      <div id="refreshed"></div>
      <div id="count"></div>
    </div>
    <div class="row">
      <input id="q" placeholder="Search player, team, injury…" />
      <button id="expandAll">Expand all</button>
      <button id="collapseAll">Collapse all</button>
      <button id="refresh">Refresh</button>
    </div>
  </header>

  <main>
    <div id="root"></div>
  </main>

<script>
  const API = "https://hoops-api.wadrake.workers.dev/api/nba/injuries";

  const elRoot = document.getElementById("root");
  const elQ = document.getElementById("q");

  const elSource = document.getElementById("source");
  const elRefreshed = document.getElementById("refreshed");
  const elCount = document.getElementById("count");

  document.getElementById("refresh").addEventListener("click", () => load(true));
  document.getElementById("expandAll").addEventListener("click", () => setAll(true));
  document.getElementById("collapseAll").addEventListener("click", () => setAll(false));
  elQ.addEventListener("input", () => render(window.__DATA__ || []));

  function setAll(open) {
    document.querySelectorAll("details.team").forEach(d => d.open = open);
  }

  function esc(s) {
    return String(s ?? "").replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  function statusLabel(s) {
    const v = String(s || "").toUpperCase();
    return v || "UNKNOWN";
  }

  function groupByTeam(items) {
    const map = new Map();
    for (const it of items) {
      const team = it.team || "—";
      if (!map.has(team)) map.set(team, []);
      map.get(team).push(it);
    }
    // sort players inside each team
    for (const [team, arr] of map.entries()) {
      arr.sort((a,b) => String(a.player||"").localeCompare(String(b.player||"")));
    }
    // sort teams
    return Array.from(map.entries()).sort((a,b) => a[0].localeCompare(b[0]));
  }

  function matchesQuery(item, q) {
    if (!q) return true;
    const blob = [
      item.player, item.team, item.injury, item.status
    ].join(" ").toLowerCase();
    return blob.includes(q);
  }

  function render(items) {
    const q = elQ.value.trim().toLowerCase();

    const filtered = items.filter(it => matchesQuery(it, q));
    const grouped = groupByTeam(filtered);

    elCount.textContent = `Shown: ${filtered.length}${q ? " (filtered)" : ""}`;

    if (!filtered.length) {
      elRoot.innerHTML = `<div class="error">No results. Try clearing search.</div>`;
      return;
    }

    elRoot.innerHTML = grouped.map(([team, list]) => {
      const outCount = list.filter(x => String(x.status||"").toUpperCase() === "OUT").length;
      const qCount = list.filter(x => String(x.status||"").toUpperCase() === "QUESTIONABLE").length;

      return `
        <details class="team" open>
          <summary>
            <div>
              <div class="teamName">${esc(team)}</div>
              <div class="tiny">${list.length} injured — OUT: ${outCount}, Q: ${qCount}</div>
            </div>
            <span class="badge">${list.length}</span>
          </summary>

          <div class="list">
            ${list.map(it => `
              <div class="card">
                <div class="topline">
                  <div class="player">${esc(it.player || "Unknown")}</div>
                  <div class="status">${esc(statusLabel(it.status))}</div>
                </div>
                <div class="sub">${esc(it.injury || "Injury")} ${it.expected_return && it.expected_return !== "—" ? `• Return: ${esc(it.expected_return)}` : ""}</div>
                <div class="tiny">Updated: ${esc(it.updated_iso || "")}</div>
              </div>
            `).join("")}
          </div>
        </details>
      `;
    }).join("");
  }

  async function load(forceFresh=false) {
    elRoot.innerHTML = `<div class="error">Loading…</div>`;

    const url = forceFresh ? `${API}?fresh=1` : API;

    const res = await fetch(url, { cache: "no-store" });
    const data = await res.json();

    if (!data || !Array.isArray(data.items)) {
      elRoot.innerHTML = `<div class="error">Bad response from API.</div>`;
      return;
    }

    window.__DATA__ = data.items;

    elSource.textContent = `Source: ${data.note || "—"}`;
    elRefreshed.textContent = `Refreshed: ${data.last_refreshed_iso || "—"}`;
    render(data.items);
  }

  load(false);
</script>
</body>
</html>
     
              
            
     
              

  
